#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>

size_t decode_byte_stream(const uint8_t* input_data, size_t input_size, char* output_buffer) {
    unsigned char temp_stack[136]; 
    size_t stack_pointer = 0; 
    size_t output_index = 0;
    size_t input_index = 0;
    while (input_index < input_size) {
        uint8_t opcode = input_data[input_index];
        switch (opcode) {
            case 0xA1:
                input_index++;
                if (input_index < input_size) {
                    if (stack_pointer < sizeof(temp_stack)) {
                        temp_stack[stack_pointer] = input_data[input_index];
                        stack_pointer++;
                    }
                }
                break;
            case 0xA2:
                if (stack_pointer > 0) {
                    stack_pointer--;
                }
                break;
            case 0xA3:
                input_index++; 
                if (input_index < input_size && stack_pointer > 0) {
                    temp_stack[stack_pointer - 1] ^= input_data[input_index];
                }
                break;
            case 0xA4: 
                input_index++; 
                if (input_index < input_size && stack_pointer > 0) {
                    temp_stack[stack_pointer - 1] += input_data[input_index];
                }
                break;
            case 0xA5: 
            case 0xEE: 
                input_index++;
                break;
            case 0xF0: 
                if (stack_pointer > 0) {
                    stack_pointer--;
                    output_buffer[output_index] = temp_stack[stack_pointer];
                    output_index++;
                }
                break;
            case 0xFF: 
                goto end_loop;

            default:
                
                break;
        }
        input_index++;
    }
end_loop:
    output_buffer[output_index] = '\0';
    return output_index;
}

int main(){
    char decoded_output[2048];
    unsigned char g_encoded_data_2020[] = {
    0xEE, 0xEF, 0xEE, 0x2F, 0xEE, 0x11, 0xA1, 0x06, 0xA3, 0x42, 0xF0, 0xEE, 0x3E, 0xEE, 0xA2, 0xEE, 
    0x6D, 0xA1, 0x0A, 0xA3, 0x42, 0xF0, 0xEE, 0x1D, 0xEE, 0xFF, 0xA1, 0x39, 0xA3, 0x42, 0xF0, 0xEE, 
    0xC7, 0xEE, 0xC4, 0xEE, 0xD6, 0xA1, 0x11, 0xA3, 0x42, 0xF0, 0xEE, 0x24, 0xEE, 0x70, 0xA1, 0x71, 
    0xA3, 0x42, 0xF0, 0xEE, 0x22, 0xEE, 0x59, 0xA1, 0x2E, 0xA3, 0x42, 0xF0, 0xEE, 0xB2, 0xEE, 0x96, 
    0xEE, 0x7B, 0xA1, 0x24, 0xA3, 0x42, 0xF0, 0xEE, 0x7E, 0xEE, 0x3C, 0xA1, 0x11, 0xA3, 0x42, 0xF0,     
    0xEE, 0x5F, 0xA1, 0x36, 0xA3, 0x42, 0xF0, 0xEE, 0x0C, 0xEE, 0xFC, 0xA1, 0x76, 0xA3, 0x42, 0xF0, 
    0xEE, 0x8A, 0xEE, 0x54, 0xA1, 0x36, 0xA3, 0x42, 0xF0, 0xEE, 0x9A, 0xEE, 0x08, 0xEE, 0xD7, 0xA1, 
    0x37, 0xA3, 0x42, 0xF0, 0xEE, 0xD7, 0xA1, 0x31, 0xA3, 0x42, 0xF0, 0xEE, 0x36, 0xA1, 0x1D, 0xA3, 
    0x42, 0xF0, 0xEE, 0x48, 0xA1, 0x14, 0xA3, 0x42, 0xF0, 0xEE, 0x3C, 0xEE, 0x52, 0xA1, 0x0F, 0xA3, 
    0x42, 0xF0, 0xEE, 0x10, 0xEE, 0x2E, 0xEE, 0x34, 0xA1, 0x1D, 0xA3, 0x42, 0xF0, 0xEE, 0xFF, 0xEE, 
    0x01, 0xEE, 0x02, 0xA1, 0x00, 0xA3, 0x42, 0xF0, 0xEE, 0x0B, 0xA1, 0x3B, 0xA3, 0x42, 0xF0, 0xEE, 
    0x3D, 0xEE, 0x88, 0xEE, 0x65, 0xA1, 0x75, 0xA3, 0x42, 0xF0, 0xEE, 0x3F, 0xEE, 0x22, 0xA1, 0x27, 
    0xA3, 0x42, 0xF0, 0xEE, 0x90, 0xEE, 0xEA, 0xEE, 0x47, 0xA1, 0x21, 0xA3, 0x42, 0xF0, 0xEE, 0xE3, 
    0xEE, 0x04, 0xEE, 0xCC, 0xA1, 0x72, 0xA3, 0x42, 0xF0, 0xEE, 0x09, 0xEE, 0x39, 0xEE, 0x78, 0xA1, 
    0x26, 0xA3, 0x42, 0xF0, 0xEE, 0x1C, 0xEE, 0x06, 0xEE, 0x42, 0xA1, 0x71, 0xA3, 0x42, 0xF0, 0xEE, 
    0x7B, 0xA1, 0x3F, 0xA3, 0x42, 0xF0, 0xFF
    };
    const size_t g_encoded_data_2020_size = sizeof(g_encoded_data_2020);
    size_t output_len = decode_byte_stream(g_encoded_data_2020, g_encoded_data_2020_size, decoded_output);
    for (size_t i = 0; i < output_len; ++i) {
        printf("%c", (char)decoded_output[i]);
    }
    printf("\n");
}
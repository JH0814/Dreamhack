import requests
from sympy.ntheory.modular import crt
import itertools
from Crypto.Util.number import long_to_bytes

x1 = [5892358770576851944010194779142018408155269683352377230085, 1694336677401205962139311720952097565100191356061224077131, 1117187172795656310152683943643284989494459111219889483535, 1209496234460555068351660279875019914921094277054458499713, 2067837922911917660459721745652030221064949224314398312705, 578740124124809504290306095713189274365030502910993131782, 1832239101007859711285956616251988975956123048584254478958]
x2 = [2013082176627958219899152142827760558588138877094933058632, 1229180282080586442669109626620027760102058948975896647258, 4443990447520328977906454834063047549863229488358434051286, 2238595894232025556881612587352542933432302168304489583584, 1021223564259233692918536093625982056297466027706555132248, 2361320481510332482544762085401842041234030948710525727135, 4231649063911843191358128939746780008835005414248250661775]
r_c = [1286115116984031812569353744445368556790531224432465748660, 2078861157806481085074549808983701252914733914897532086553, 465081297744334067033259055398746019612178858559030817016, 398387169615859315047873871045543010112569570532199953189, 1330701952994321238381952349141448199248888892187205197827, 2892778762620743092764267465632502497140472836345956864461, 3228004616708985585395070532849357534162835536086755874070]

e = 65537

n = 8975502133751214976596793703183778052411011900177500243768777282330816642056981805811790381829483492764428342215634574515821129324659800319669470444347308735098976382711415057849209479083341304289325588022365320881178773419236262216119250430093589879414038269150815374450628239576115768958852492475676545522400519332805393188998864390591853176252627728565672043111360212467611093427958594553564254039625861259945824906961382228127521282726473360953455128365565001878958661262632508365216646496027940234321884891930629986304239076793645107208143726178096518566384747230322225715547450298392435237613819683
c = 15461874548145497262627805918288797407669606228369032108253216879252263093191844833274031668859587655937562434306419833655956718859053870677478031885290931003134838826745094486914725551854018991339414554936128395837978778906901696598726392699093619066687473015344367916666146016716893963987699353447211290577314280308336887626612489

def factordb_pq(n):
    j = requests.get(f"https://factordb.com/api?query={n}", timeout=5).json()
    p, q = int(j["factors"][0][0]), int(j["factors"][1][0])
    return (p, q) if p < q else (q, p)

r_n = []
for i in range(len(x1)):
    r_n.append(x1[i] ^ x2[i])

r = []
for i in range(len(r_n)):
    p, q = factordb_pq(r_n[i])
    phi = (p - 1) * (q - 1)
    d = pow(e, -1, phi)
    m = pow(r_c[i], d, r_n[i])
    r.append(p)
    r.append(q)
    r.append(m)

all_roots = []
for p in r:
    m_p = pow(c, (p + 1) // 4, p)
    all_roots.append((m_p, p - m_p)) 
    
for i, combo in enumerate(itertools.product(*all_roots)):
    remainders = list(combo)
    m_candidate = crt(r, remainders)[0]
    for m_final in [m_candidate, n - m_candidate]:
        try:
            flag_bytes = long_to_bytes(m_final)
            if b'DH{' in flag_bytes:
                print("Flag : " + flag_bytes.decode())
                exit(0)
        except Exception:
            pass
